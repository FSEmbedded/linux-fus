// SPDX-License-Identifier: GPL-2.0
/*
* Copyright 2024 F&S Elektronik Systeme GmbH
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License version 2 as
* published by the Free Software Foundation.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*/

/dts-v1/;

/* Set board revision as 3-digit number, e.g. 110 for board rev. 1.10 */
#define CONFIG_PICOCOREMX8ULP_BOARD_REVISION	110
/* Set baseboard revision as 3-digit number, e.g. 110 for board rev. 1.10 */
#define CONFIG_PICOCOREBBDSI_BOARD_REVISION	140

/* Cortex-M is always supported */

/* Network*/
/* WLAN/BLUETOOTH */
#define CONFIG_PICOCOREMX8ULP_WLAN

/* AUDIO */
#define CONFIG_PICOCOREMX8ULP_AUDIO_APD
/* LPAUDIO is currently not supported */
// #define CONFIG_PICOCOREMX8ULP_AUDIO_RTD

/*
 * SD_A - External SD port with Card Detect (CD) and Write Protect (WP)
 * On picocoremx8ulp SKIT: external port is Micro-SD card slot with CD but without WP
 */
#if !defined(CONFIG_PICOCOREMX8ULP_WLAN)
#define CONFIG_PICOCOREMX8ULP_SD_A
#define CONFIG_PICOCOREMX8ULP_SD_A_CD
#define CONFIG_PICOCOREMX8ULP_SD_A_WP
#endif

#include "picocoremx8ulp.dtsi"
#include <dt-bindings/usb/pd.h>

/ {
	model = "F&S PicoCoreMX8ULP";
	compatible = "fus,picocoremx8ulp", "fus,fsimx8ulp", "fsl,imx8ulp";
};

&pc_eth {
	status = "okay";
};

&pc_uart_a {
	status = "okay";
};

&pc_uart_c {
	status = "okay";
};

&pc_i2c_a {
	status = "okay";
};

&pc_i2c_b {
	status = "okay";
};

&pc_i2c_c {
	status = "okay";
};

&pc_i2c_d {
	status = "okay";
	ptn5110: tcpc@52 {
		compatible = "nxp,ptn5110";
		reg = <0x52>;
		interrupt-parent = <&rp_gpioc>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;

		port {
			typec_dr_sw: endpoint {
				remote-endpoint = <&usb1_drd_sw>;
			};
		};

		usb_con: connector {
			compatible = "usb-c-connector";
			label = "USB-C";
			power-role = "dual";
			data-role = "dual";
			try-power-role = "sink";
			source-pdos = <PDO_FIXED(5000, 3000,
			PDO_FIXED_USB_COMM)>;
			sink-pdos = <PDO_FIXED(5000, 3000, PDO_FIXED_USB_COMM)
				     PDO_VAR(5000, 20000, 3000)>;
			op-sink-microwatt = <15000000>;
			self-powered;
		};
	};
};

&pc_spi_a {
	status = "okay";

	spidev0: spidev@0 {
		/* use default driver */
		compatible = "lwn,bk4";
		spi-max-frequency = <1000000>;
		reg = <0>;
		status = "okay";
	};
};

&pc_sdio_a {
	status = "okay";
};

&pc_usb_1 {
	dr_mode = "otg";
	hnp-disable;
	srp-disable;
	adp-disable;
	disable-over-current;
	usb-role-switch;
	status = "okay";

	port {
		usb1_drd_sw: endpoint {
			remote-endpoint = <&typec_dr_sw>;
		};
	};
};

&pc_usb_2 {
	dr_mode = "host";
	power-active-high;
	disable-over-current;
	status = "okay";
};

&pc_bl_pwm {
	status = "okay";
};
