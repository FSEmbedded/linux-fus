// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright 2024 NXP
 */

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/pwm/pwm.h>

/ {

	regulators {
		reg_lcd_bl: backlight_lcd {
			compatible = "regulator-fixed";
			regulator-name = "lcd-bl";
			gpio = <&pca963x 0 0>;
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			enable-active-high;
		};
	};

	backlight_lcd: backlight_lcd {
		compatible = "pwm-backlight";
		pwms = <&pca963x 1 640000 0>;
		power-supply = <&reg_lcd_bl>;
		brightness-levels = <0 1 5 10 18 28 41 56
				     73 92 113 137 163 192 222 255>;
		default-brightness-level = <14>;
		fb-names = "lcd";
	};

	/* Simple panel driver */
	panel: panel {
		compatible = "edt,et070080dh6";
		backlight = <&backlight_lcd>;
		power-supply = <&reg_vlcd>;

		port@0 {
			panel_in: endpoint {
				remote-endpoint = <&display_out>;
			};
		};
	};
};


&lcdif {
	assigned-clock-rates = <300000000>, <33000000>, <400000000>, <133333333>;
	status = "okay";
};

&media_blk_ctrl {
	status = "okay";
};

&parallel_disp_fmt {
	pinctrl-names = "default", "gpio";
	pinctrl-0 = <&pinctrl_lcdif>;
	pinctrl-1 = <&pinctrl_lcdif_gpio>;
	fsl,interface-pix-fmt = "rgb666";
	status = "okay";

	ports {
		port@1 {
			reg = <1>;
			display_out: endpoint {
				remote-endpoint = <&panel_in>;
			};
		};
	};
};

&IMX93_TOUCH_I2C {

	pca963x: pca9632@60 {
		compatible = "fus,pca9632";
		reg = <0x60>;
		nxp,totem-pole;
		#address-cells = <1>;
		#size-cells = <0>;
		#pwm-cells = <3>;
		#gpio-cells = <2>;
		led@0 {
			reg = <0>;
			label = "0-PWRCTL";
			type = "GPIO";
			default-on;		/* or: keep-value */
			active-high;
		};
		led@1 {
			reg = <1>;
			label = "1-LEDCTRL";
			type = "PWM";
			default-on;		/* or: keep-value */
			active-low;
		};
		led@2 {
			reg = <2>;
			label = "2-ROTATE";
			type = "GPIO";
			active-high;		/* optionally: keep value */
		};
		led@3 {
			reg = <3>;
			label = "3-unused";
			type = "LED";
			active-low;
		};
	};

	tsc2004@4a {
		compatible = "ti,tsc2004";
		reg = <0x4a>;
		vio-supply = <&reg_vlcd>;
		interrupts-extended = <&IMX93_TOUCH_INTERRUPT_GPIO_BANK IMX93_TOUCH_INTERRUPT_GPIO_NUM IRQ_TYPE_EDGE_FALLING>;

		touchscreen-fuzz-x = <4>;
		touchscreen-fuzz-y = <7>;
		touchscreen-fuzz-pressure = <20>;
		touchscreen-size-x = <4096>;
		touchscreen-size-y = <4096>;
		touchscreen-max-pressure = <2048>;
		touchscreen-inverted-y;
		ti,x-plate-ohms = <900>;
		ti,sense-time-sel = <4>;
		ti,pre-charge-time = <4>;
		//ti,esd-recovery-timeout-ms = <8000>;
	};
};

&iomuxc {
	pinctrl_lcdif: lcdifgrp {
		fsl,pins = <
			MX93_PAD_GPIO_IO00__MEDIAMIX_DISP_CLK		0x31e
			MX93_PAD_GPIO_IO01__MEDIAMIX_DISP_DE		0x31e
			MX93_PAD_GPIO_IO02__MEDIAMIX_DISP_VSYNC		0x31e
			MX93_PAD_GPIO_IO03__MEDIAMIX_DISP_HSYNC		0x31e
			MX93_PAD_GPIO_IO04__MEDIAMIX_DISP_DATA00		0x31e
			MX93_PAD_GPIO_IO05__MEDIAMIX_DISP_DATA01		0x31e
			MX93_PAD_GPIO_IO06__MEDIAMIX_DISP_DATA02		0x31e
			MX93_PAD_GPIO_IO07__MEDIAMIX_DISP_DATA03		0x31e
			MX93_PAD_GPIO_IO08__MEDIAMIX_DISP_DATA04		0x31e
			MX93_PAD_GPIO_IO09__MEDIAMIX_DISP_DATA05		0x31e
			MX93_PAD_GPIO_IO10__MEDIAMIX_DISP_DATA06		0x31e
			MX93_PAD_GPIO_IO11__MEDIAMIX_DISP_DATA07		0x31e
			MX93_PAD_GPIO_IO12__MEDIAMIX_DISP_DATA08		0x31e
			MX93_PAD_GPIO_IO13__MEDIAMIX_DISP_DATA09		0x31e
			MX93_PAD_GPIO_IO14__MEDIAMIX_DISP_DATA10	0x31e
			MX93_PAD_GPIO_IO15__MEDIAMIX_DISP_DATA11	0x31e
			MX93_PAD_GPIO_IO16__MEDIAMIX_DISP_DATA12	0x31e
			MX93_PAD_GPIO_IO17__MEDIAMIX_DISP_DATA13	0x31e
			MX93_PAD_GPIO_IO18__MEDIAMIX_DISP_DATA14	0x31e
			MX93_PAD_GPIO_IO19__MEDIAMIX_DISP_DATA15	0x31e
			MX93_PAD_GPIO_IO20__MEDIAMIX_DISP_DATA16	0x31e
			MX93_PAD_GPIO_IO21__MEDIAMIX_DISP_DATA17	0x31e
		>;
	};

	pinctrl_lcdif_gpio: lcdifgpiogrp {
		fsl,pins = <
			MX93_PAD_GPIO_IO00__GPIO2_IO00			0x51e
			MX93_PAD_GPIO_IO01__GPIO2_IO01			0x51e
			MX93_PAD_GPIO_IO02__GPIO2_IO02			0x51e
			MX93_PAD_GPIO_IO03__GPIO2_IO03			0x51e
			MX93_PAD_GPIO_IO04__GPIO2_IO04			0x51e
			MX93_PAD_GPIO_IO05__GPIO2_IO05			0x51e
			MX93_PAD_GPIO_IO06__GPIO2_IO06			0x51e
			MX93_PAD_GPIO_IO07__GPIO2_IO07			0x51e
			MX93_PAD_GPIO_IO08__GPIO2_IO08			0x51e
			MX93_PAD_GPIO_IO09__GPIO2_IO09			0x51e
			MX93_PAD_GPIO_IO10__GPIO2_IO10			0x51e
			MX93_PAD_GPIO_IO11__GPIO2_IO11			0x51e
			MX93_PAD_GPIO_IO12__GPIO2_IO12			0x51e
			MX93_PAD_GPIO_IO13__GPIO2_IO13			0x51e
			MX93_PAD_GPIO_IO14__GPIO2_IO14			0x51e
			MX93_PAD_GPIO_IO15__GPIO2_IO15			0x51e
			MX93_PAD_GPIO_IO16__GPIO2_IO16			0x51e
			MX93_PAD_GPIO_IO17__GPIO2_IO17			0x51e
			MX93_PAD_GPIO_IO18__GPIO2_IO18			0x51e
			MX93_PAD_GPIO_IO19__GPIO2_IO19			0x51e
			MX93_PAD_GPIO_IO20__GPIO2_IO20			0x51e
			MX93_PAD_GPIO_IO21__GPIO2_IO21			0x51e
		>;
	};
};
